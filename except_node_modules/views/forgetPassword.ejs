<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" />
    <link rel="stylesheet" href="/stylesheets/forgetPassword.css">
    <title>Hello, world!</title>
</head>

<body>
    <div class="modal fade " id="forgetPasswordModal" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" style="width: 1250px;">
            <div class="modal-content">
                <div class="modal-header " style="border: none; ">
                    <h5 class="modal-title" id="exampleModalLabel"><i class="fa-brands fa-twitter"></i></h5>

                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container one" id="one">

                        <h1>Find your Twitter account</h1>
                        <p>Enter the email associated with your account to change your password.</p>
                        <input type="text" name="user_mail" placeholder="Enter your email" style="width: 440px;"
                            id="mail">
                            <p id="mailWarning"></p>
                        <input type="submit" value="Next" id="forgetNextBtn1" class="p-2 forgetNextBtn mt-3 mb-5">
                    </div>
                    <div class="container second" id="two">

                        <h1>We sent you a code</h1>
                        <p>Check your email to get your confirmation code. If you need to request a new code, go back
                            and reselect a confirmation.</p>
                        <input type="text" name="otp" id="otp" placeholder="Enter your code">
                        <p id="wrong-otp-warning"></p>
                        <input type="submit" value="Back" id="forgetNextBtn2" class="p-2 forgetNextBtn mt-3 mb-5">
                    </div>
                    <div class="container three" id="three">
                        <h1>Choose a new password</h1>
                        <p>Make sure your new password is 8 characters or more. Try including numbers, letters and punctuation marks for a strong password. </p>
                        <input type="text" name="newPwd" id="newPwd" placeholder="Enter new password">
                        <p id="newPwd-warning"></p>
                        <input type="text" name="confirmPwd" id="confirmPwd" placeholder="Confirm your password">
                        <p id="confirmPwd-warning"></p>
                        <input type="submit" value="Change Password" id="forgetNextBtn2" class="p-2 forgetNextBtn mt-3 mb-5">  
                    </div>
                </div>
              
            </div>
        </div>
        <div class="modal-footer" style="border: none; justify-content: center;">

        </div>
    </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>
        // $(document).ready(function(){
        //     $("#forgetPasswordModal").modal("show");
        //     $(".second").hide()

        // })
        // $("#forgetNextBtn").click(function(){
        //     $(".one").hide();
        //     $(".second").show()

        //     $(this).val('Back');
        // })
        var div1 = document.getElementById("one");
        var div2 = document.getElementById("two");
        var div3 = document.getElementById("three");
        var btn1 = document.getElementById("forgetNextBtn1");
        var btn2 = document.getElementById("forgetNextBtn2");
        var otp = document.getElementById("otp");
        var mail = document.getElementById("mail");
        var otpWarnPara = document.getElementById("wrong-otp-warning");

        window.addEventListener("load", (event) => {
            var myModal = new bootstrap.Modal(document.getElementById('forgetPasswordModal'), {})
            myModal.show()
            div1.style.display = "block";
            div2.style.display = "none";
            div3.style.display = "none";
        });

        btn1.addEventListener("click", async () => {
            var mail = document.getElementById("mail").value;
            var data = await fetch(`/getMail?val=${mail}`);
            var data1 = await data.json();
            if(data1.mailExistStatus){
                div1.style.display = "none";
                div2.style.display = "block";
                div3.style.display = "none";
            }else{
                var mailWarning = document.getElementById("mailWarning");
                mailWarning.innerHTML="Enter the valid email"
                mailWarning.style.color = "red"
            }
        })



        if (otp.value == "") {
                        btn2.addEventListener("click", () => {
                            div1.style.display = "block";
                            div2.style.display = "none";
                            div3.style.display = "none";
                        })
                    }
        
        otp.addEventListener("input", () => {
            if (otp.value == "") {
                btn2.value = "Back";
                btn2.addEventListener("click", () => {
                    console.log("NOVALUE");
                    // div2.style.display = "none";
                    // div3.style.display = "none";
                    // div1.style.display = "block";   
                    div2.classList.add("d-none");
                    div3.classList.add("d-none");
                    div1.classList.add("d-block");
                })
            } else {
                btn2.value = "Next";
                btn2.addEventListener("click", async () => {
                    var otpVal = otp.value;
                    console.log("VALUE IS available");


                    await fetch(`/getOtp?otp=${otpVal}`).then((response) => response.json())
                        .then((data) => {
                            if (data.verified) {
                                div1.style.display = "none";
                                div2.style.display = "none";
                                div3.style.display = "block";
                            } else {
                                div1.style.display = "none";
                                div2.style.display = "block";
                                div3.style.display = "none";
                                otpWarnPara.innerHTML = "Enter the correct otp or else go back to get another mail";
                                otpWarnPara.style.color = "red";
                                document.getElementById("otp").value = "";
                                if (otp.value == "") {
                                    btn2.value = "Back";
                                    btn2.addEventListener("click", () => {
                                        // alert("j")
                                        // div1.style.display = "block";
                                        // div2.style.display = "none";
                                        // div3.style.display = "none";
                                        window.addEventListener("load", (event) => {
            var myModal = new bootstrap.Modal(document.getElementById('forgetPasswordModal'), {})
            myModal.show()
            div1.style.display = "block";
            div2.style.display = "none";
            div3.style.display = "none";
        });
                                    })
                                }

                            }
                        })

                 

                })
            }
        })


    </script>

</body>

</html>